<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é›²ç«¯æ±½è»Šç®¡å®¶</title>
    <style>
        :root { --p: #1a73e8; }
        body { font-family: sans-serif; background: #f4f7f6; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h2 { color: var(--p); text-align: center; }
        label { display: block; margin: 15px 0 5px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn { width: 100%; padding: 15px; background: var(--p); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; margin-top: 20px; cursor: pointer; }
        .status { text-align: center; margin-top: 15px; color: #666; font-size: 14px; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸš— é›²ç«¯æ•¸æ“šè¼¸å…¥</h2>
    
    <label>æ—¥æœŸ</label>
    <input type="date" id="date">

    <label>é¡åˆ¥</label>
    <select id="category" onchange="toggleFields()">
        <option value="fuel">â›½ åŠ æ²¹</option>
        <option value="maint">ğŸ› ï¸ ç¶­ä¿®/ä¿é¤Š</option>
    </select>

    <label>ç›®å‰ç¸½é‡Œç¨‹ (Km)</label>
    <input type="number" id="km" placeholder="ä¾‹å¦‚: 50200">

    <div id="fuelDiv">
        <label>åŠ æ²¹å…¬å‡æ•¸ (L)</label>
        <input type="number" id="amount" step="0.01">
    </div>

    <div id="maintDiv" style="display:none;">
        <label>ä¿é¤Šé …ç›®</label>
        <input type="text" id="maintName" placeholder="å¦‚: æ›æ©Ÿæ²¹">
    </div>

    <label>æ”¯å‡ºé‡‘é¡ ($)</label>
    <input type="number" id="cost">

    <button class="btn" onclick="uploadData()">å„²å­˜ä¸¦ä¸Šå‚³è‡³é›²ç«¯</button>
    <div id="status" class="status">ç­‰å¾…è¼¸å…¥...</div>
</div>

<script>
    // é è¨­ä»Šå¤©æ—¥æœŸ
    document.getElementById('date').valueAsDate = new Date();

    function toggleFields() {
        const cat = document.getElementById('category').value;
        document.getElementById('fuelDiv').style.display = (cat === 'fuel') ? 'block' : 'none';
        document.getElementById('maintDiv').style.display = (cat === 'maint') ? 'block' : 'none';
    }

    async function uploadData() {
        // âš ï¸ è«‹åœ¨æ­¤è™•è²¼ä¸Šä½ åœ¨ç¬¬äºŒéšæ®µç²å¾—çš„ Google éƒ¨ç½²ç¶²å€
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwrLQ1a7QBcfy3oxFhU4djEewSY2ev7wocq1-A0vRWI3g9pIutv4Nb-uZhmbqIUoRSL/exec";

        const data = {
            date: document.getElementById('date').value,
            category: document.getElementById('category').value,
            km: document.getElementById('km').value,
            amount: document.getElementById('amount').value,
            cost: document.getElementById('cost').value,
            name: (document.getElementById('category').value === 'fuel') ? 'åŠ æ²¹' : document.getElementById('maintName').value
        };

        if (!data.km || !data.cost) {
            alert("è«‹å®Œæ•´è¼¸å…¥é‡Œç¨‹èˆ‡é‡‘é¡ï¼");
            return;
        }

        const status = document.getElementById('status');
        status.innerText = "ğŸš€ æ­£åœ¨ä¸Šå‚³è‡³ Google Sheet...";

        try {
            // ä½¿ç”¨ no-cors æ¨¡å¼ç™¼é€
            await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            status.innerText = "âœ… å·²æˆåŠŸè¨˜éŒ„åœ¨é›²ç«¯ï¼";
            alert("æ•¸æ“šå·²è‡ªå‹•ä¸Šå‚³ï¼");
            // æ¸…é™¤æ¬„ä½
            document.getElementById('km').value = "";
            document.getElementById('amount').value = "";
            document.getElementById('cost').value = "";
        } catch (e) {
            status.innerText = "âŒ éŒ¯èª¤ï¼š" + e;
        }
    }
</script>

</body>
</html>